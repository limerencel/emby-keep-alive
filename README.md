# Emby Keep-Alive

ä¸€ä¸ªç”¨äºä¿æŒ Emby æœåŠ¡å™¨æ´»è·ƒçŠ¶æ€çš„è‡ªåŠ¨åŒ–å·¥å…·ï¼Œé€šè¿‡æ¨¡æ‹ŸçœŸå®çš„è§‚çœ‹è¡Œä¸ºæ¥ç»´æŒæœåŠ¡å™¨è¿æ¥å’Œç”Ÿæˆæ’­æ”¾å†å²è®°å½•ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- ğŸ¬ **çœŸå®æ’­æ”¾æ¨¡æ‹Ÿ** - æ¨¡æ‹Ÿå®Œæ•´çš„è§‚çœ‹ä¼šè¯ï¼ŒåŒ…æ‹¬æ’­æ”¾å¼€å§‹ã€è¿›åº¦æ›´æ–°å’Œæ­£å¸¸ç»“æŸ
- ğŸ”„ **å¤šæœåŠ¡å™¨æ”¯æŒ** - åŒæ—¶åœ¨å¤šä¸ª Emby æœåŠ¡å™¨ä¸Šå¹¶å‘æ‰§è¡Œä¿æ´»ä»»åŠ¡
- ğŸ“± **è·¨å¹³å°åŒæ­¥** - ç”Ÿæˆçš„æ’­æ”¾å†å²åœ¨æ¡Œé¢å’Œç§»åŠ¨å®¢æˆ·ç«¯éƒ½å¯è§
- â° **æ™ºèƒ½è°ƒåº¦** - æ”¯æŒ cron å®šæ—¶æ‰§è¡Œï¼Œæ¯å¤©éšæœºæ—¶é—´è¿è¡Œ
- ğŸ›¡ï¸ **ä¼˜é›…é€€å‡º** - Ctrl+C æ—¶è‡ªåŠ¨ä¿å­˜å½“å‰æ’­æ”¾è¿›åº¦
- ğŸ“Š **å®Œå–„æ—¥å¿—** - å¤šå±‚æ¬¡æ—¥å¿—è®°å½•ï¼Œä¾¿äºç›‘æ§å’Œè°ƒè¯•
- ğŸ” **å®‰å…¨é…ç½®** - æ”¯æŒè‡ªç­¾åè¯ä¹¦ï¼Œä¸“ç”¨ç”¨æˆ·æƒé™ç®¡ç†

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æœ¬åœ°è¿è¡Œ

1. **å…‹éš†é¡¹ç›®**
   ```bash
   git clone https://github.com/limerencel/emby-keep-alive.git
   cd emby-keep-alive
   ```

2. **å®‰è£…ä¾èµ–**
   ```bash
   # ä½¿ç”¨ uv å®‰è£…ä¾èµ–ï¼ˆæ¨èï¼‰
   uv sync
   
   # æˆ–è€…ä½¿ç”¨ä¼ ç»Ÿæ–¹å¼
   pip install aiohttp
   ```

3. **é…ç½®æœåŠ¡å™¨ä¿¡æ¯**
   ```bash
   cp emby.copy.json emby.json
   # ç¼–è¾‘ emby.json å¡«å…¥ä½ çš„æœåŠ¡å™¨ä¿¡æ¯
   ```

4. **è¿è¡Œç¨‹åº**
   ```bash
   # ä½¿ç”¨ uv è¿è¡Œï¼ˆæ¨èï¼‰
   uv run main.py
   
   # æˆ–è€…ä½¿ç”¨ä¼ ç»Ÿæ–¹å¼
   python main.py
   ```

### é…ç½®æ–‡ä»¶æ ¼å¼

`emby.json` é…ç½®æ–‡ä»¶ç¤ºä¾‹ï¼š
```json
{
    "servers": [
        "https://emby.example1.com:8096/",
        "https://emby.example2.com/",
        "http://192.168.1.100:8096/"
    ],
    "usernames": ["user1", "user2", "user3"],
    "passwords": ["pass1", "pass2", "pass3"]
}
```

## ğŸ–¥ï¸ æœåŠ¡å™¨éƒ¨ç½²

### ç³»ç»Ÿè¦æ±‚

- Linux æœåŠ¡å™¨ (Ubuntu/CentOS/Debian)
- Python 3.8+
- uv åŒ…ç®¡ç†å™¨
- ç½‘ç»œè¿æ¥åˆ° Emby æœåŠ¡å™¨

### ä¸€é”®éƒ¨ç½²

1. **å®‰è£… uv**ï¼ˆå¦‚æœæœªå®‰è£…ï¼‰
   ```bash
   curl -LsSf https://astral.sh/uv/install.sh | sh
   ```

2. **ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨**
   ```bash
   git clone https://github.com/limerencel/emby-keep-alive.git
   cd emby-keep-alive
   ```

3. **æ‰§è¡Œéƒ¨ç½²è„šæœ¬**
   ```bash
   chmod +x deploy-simple.sh
   sudo ./deploy-simple.sh
   ```

4. **éªŒè¯éƒ¨ç½²**
   ```bash
   # æŸ¥çœ‹ cron ä»»åŠ¡
   sudo -u emby-alive crontab -l
   
   # æ‰‹åŠ¨æµ‹è¯•è¿è¡Œ
   sudo -u emby-alive /opt/emby-alive/run.sh
   
   # æŸ¥çœ‹æ—¥å¿—
   tail -f /var/log/emby-alive/emby-alive.log
   ```

### éƒ¨ç½²åçš„æ–‡ä»¶ç»“æ„

```
/opt/emby-alive/
â”œâ”€â”€ main.py                    # ä¸»ç¨‹åº
â”œâ”€â”€ emby.json                  # æœåŠ¡å™¨é…ç½®
â”œâ”€â”€ run.sh                     # è¿è¡Œè„šæœ¬
â”œâ”€â”€ pyproject.toml            # uv é¡¹ç›®é…ç½®
â”œâ”€â”€ uv.lock                   # uv é”å®šæ–‡ä»¶
â””â”€â”€ .venv/                    # Pythonè™šæ‹Ÿç¯å¢ƒ

/var/log/emby-alive/
â””â”€â”€ emby-alive.log            # åº”ç”¨ç¨‹åºæ—¥å¿—

/etc/logrotate.d/
â””â”€â”€ emby-keeper               # æ—¥å¿—è½®è½¬é…ç½®
```

## â° è°ƒåº¦é…ç½®

### é»˜è®¤è°ƒåº¦ç­–ç•¥

- **æ‰§è¡Œæ—¶é—´**: æ¯å¤© 22:00-22:59 ä¹‹é—´çš„éšæœºåˆ†é’Ÿæ‰§è¡Œ
- **è°ƒåº¦æ–¹å¼**: ä½¿ç”¨ cron job å®šæ—¶æ‰§è¡Œ
- **ç”¨æˆ·æƒé™**: ä»¥ `emby-alive` ç”¨æˆ·èº«ä»½è¿è¡Œ

### æŸ¥çœ‹å’Œä¿®æ”¹ cron ä»»åŠ¡

```bash
# æŸ¥çœ‹å½“å‰ cron ä»»åŠ¡
sudo -u emby-alive crontab -l

# ç¼–è¾‘ cron ä»»åŠ¡ï¼ˆä¿®æ”¹æ‰§è¡Œæ—¶é—´ï¼‰
sudo -u emby-alive crontab -e

# ç¤ºä¾‹ï¼šæ”¹ä¸ºæ¯å¤© 20:30 æ‰§è¡Œ
# 30 20 * * * /opt/emby-alive/run.sh
```

## ğŸ“Š æ—¥å¿—ç®¡ç†

### æ—¥å¿—æ–‡ä»¶è¯´æ˜

| æ—¥å¿—æ–‡ä»¶ | å†…å®¹ | ç”¨é€” |
|---------|------|------|
| `emby-alive.log` | åº”ç”¨ç¨‹åºè¾“å‡º | æŸ¥çœ‹æ’­æ”¾ä¼šè¯è¯¦æƒ… |

### å¸¸ç”¨æ—¥å¿—å‘½ä»¤

```bash
# å®æ—¶æŸ¥çœ‹åº”ç”¨æ—¥å¿—
tail -f /var/log/emby-alive/emby-alive.log

# æŸ¥çœ‹æœ€è¿‘çš„æ—¥å¿—
tail -100 /var/log/emby-alive/emby-alive.log

# æŸ¥çœ‹ cron æ‰§è¡Œè®°å½•
grep emby-alive /var/log/syslog
```

### æ—¥å¿—è½®è½¬

- **è½®è½¬å‘¨æœŸ**: æ¯æ—¥è½®è½¬
- **ä¿ç•™æ—¶é—´**: 30å¤©
- **å‹ç¼©**: è‡ªåŠ¨å‹ç¼©æ—§æ—¥å¿—
- **æƒé™**: è‡ªåŠ¨è®¾ç½®æ­£ç¡®çš„æ–‡ä»¶æƒé™

## ğŸ”§ æœåŠ¡ç®¡ç†

### åŸºæœ¬å‘½ä»¤

```bash
# æ‰‹åŠ¨æ‰§è¡Œä¸€æ¬¡
sudo -u emby-alive /opt/emby-alive/run.sh

# æŸ¥çœ‹ cron ä»»åŠ¡çŠ¶æ€
sudo -u emby-alive crontab -l

# ç¼–è¾‘ cron ä»»åŠ¡
sudo -u emby-alive crontab -e

# æ¸…ç†æ—¥å¿—æ–‡ä»¶
sudo truncate -s 0 /var/log/emby-alive/emby-alive.log
```

### é…ç½®ä¿®æ”¹

```bash
# ä¿®æ”¹EmbyæœåŠ¡å™¨é…ç½®
sudo nano /opt/emby-alive/emby.json

# æµ‹è¯•é…ç½®æ˜¯å¦æ­£ç¡®
sudo -u emby-alive /opt/emby-alive/run.sh
```

## ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

### ç³»ç»Ÿå®‰å…¨

- **ä¸“ç”¨ç”¨æˆ·**: ä½¿ç”¨ `emby-alive` ç”¨æˆ·è¿è¡Œï¼Œé¿å…æƒé™è¿‡é«˜
- **ç›®å½•éš”ç¦»**: é™åˆ¶æ–‡ä»¶ç³»ç»Ÿè®¿é—®æƒé™  
- **ç½‘ç»œå®‰å…¨**: æ”¯æŒè‡ªç­¾åSSLè¯ä¹¦

### é…ç½®æ–‡ä»¶å®‰å…¨

- **æƒé™æ§åˆ¶**: `emby.json` è®¾ç½®ä¸º 600 æƒé™ï¼Œä»…æ‰€æœ‰è€…å¯è¯»å†™
- **æ•æ„Ÿä¿¡æ¯**: å¯†ç ç­‰æ•æ„Ÿä¿¡æ¯ä¸ä¼šå‡ºç°åœ¨æ—¥å¿—ä¸­
- **å¤‡ä»½å»ºè®®**: å®šæœŸå¤‡ä»½é…ç½®æ–‡ä»¶åˆ°å®‰å…¨ä½ç½®

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **SSLè¯ä¹¦é”™è¯¯**
   ```
   [SSL: CERTIFICATE_VERIFY_FAILED]
   ```
   **è§£å†³æ–¹æ¡ˆ**: ç¨‹åºå·²è‡ªåŠ¨ç¦ç”¨SSLéªŒè¯ï¼Œæ”¯æŒè‡ªç­¾åè¯ä¹¦

2. **ç™»å½•å¤±è´¥**
   ```
   ç™»å½•å¤±è´¥: HTTP 401
   ```
   **è§£å†³æ–¹æ¡ˆ**: æ£€æŸ¥ `emby.json` ä¸­çš„ç”¨æˆ·åå’Œå¯†ç æ˜¯å¦æ­£ç¡®

3. **uv å‘½ä»¤ä¸å­˜åœ¨**
   ```
   uv å‘½ä»¤ä¸å­˜åœ¨
   ```
   **è§£å†³æ–¹æ¡ˆ**: 
   ```bash
   curl -LsSf https://astral.sh/uv/install.sh | sh
   ```

4. **æƒé™é—®é¢˜**
   ```
   Permission denied
   ```
   **è§£å†³æ–¹æ¡ˆ**: ç¡®ä¿ä»¥ root æƒé™è¿è¡Œéƒ¨ç½²è„šæœ¬
   ```bash
   sudo ./deploy-simple.sh
   ```

5. **æ’­æ”¾å†å²ä¸æ˜¾ç¤º**
   - ç¡®ä¿è§‚çœ‹æ—¶é—´è¶…è¿‡30ç§’
   - æ£€æŸ¥EmbyæœåŠ¡å™¨ç‰ˆæœ¬å…¼å®¹æ€§
   - æŸ¥çœ‹åº”ç”¨æ—¥å¿—ç¡®è®¤APIè°ƒç”¨æˆåŠŸ

### è°ƒè¯•æ¨¡å¼

å¦‚éœ€è°ƒè¯•ï¼Œå¯ä»¥æ‰‹åŠ¨è¿è¡Œç¨‹åºï¼š

```bash
cd /opt/emby-alive
sudo -u emby-alive uv run main.py
```
