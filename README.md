# Emby Keep-Alive

ä¸€ä¸ªç”¨äºä¿æŒ Emby æœåŠ¡å™¨æ´»è·ƒçŠ¶æ€çš„è‡ªåŠ¨åŒ–å·¥å…·ï¼Œé€šè¿‡æ¨¡æ‹ŸçœŸå®çš„è§‚çœ‹è¡Œä¸ºæ¥ç»´æŒæœåŠ¡å™¨è¿æ¥å’Œç”Ÿæˆæ’­æ”¾å†å²è®°å½•ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- ğŸ¬ **çœŸå®æ’­æ”¾æ¨¡æ‹Ÿ** - æ¨¡æ‹Ÿå®Œæ•´çš„è§‚çœ‹ä¼šè¯ï¼ŒåŒ…æ‹¬æ’­æ”¾å¼€å§‹ã€è¿›åº¦æ›´æ–°å’Œæ­£å¸¸ç»“æŸ
- ğŸ”„ **å¤šæœåŠ¡å™¨æ”¯æŒ** - åŒæ—¶åœ¨å¤šä¸ª Emby æœåŠ¡å™¨ä¸Šå¹¶å‘æ‰§è¡Œä¿æ´»ä»»åŠ¡
- ğŸ“± **è·¨å¹³å°åŒæ­¥** - ç”Ÿæˆçš„æ’­æ”¾å†å²åœ¨æ¡Œé¢å’Œç§»åŠ¨å®¢æˆ·ç«¯éƒ½å¯è§
- â° **æ™ºèƒ½è°ƒåº¦** - æ”¯æŒéšæœºæ—¶é—´æ‰§è¡Œï¼Œé¿å…å›ºå®šæ¨¡å¼è¢«æ£€æµ‹
- ğŸ›¡ï¸ **ä¼˜é›…é€€å‡º** - Ctrl+C æ—¶è‡ªåŠ¨ä¿å­˜å½“å‰æ’­æ”¾è¿›åº¦
- ğŸ“Š **å®Œå–„æ—¥å¿—** - å¤šå±‚æ¬¡æ—¥å¿—è®°å½•ï¼Œä¾¿äºç›‘æ§å’Œè°ƒè¯•
- ğŸ” **å®‰å…¨é…ç½®** - æ”¯æŒè‡ªç­¾åè¯ä¹¦ï¼Œä¸“ç”¨ç”¨æˆ·æƒé™ç®¡ç†

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æœ¬åœ°è¿è¡Œ

1. **å…‹éš†é¡¹ç›®**
   ```bash
   git clone <repository-url>
   cd emby-alive
   ```

2. **å®‰è£…ä¾èµ–**
   ```bash
   pip install -r requirements.txt
   ```

3. **é…ç½®æœåŠ¡å™¨ä¿¡æ¯**
   ```bash
   cp emby.copy.json emby.json
   # ç¼–è¾‘ emby.json å¡«å…¥ä½ çš„æœåŠ¡å™¨ä¿¡æ¯
   ```

4. **è¿è¡Œç¨‹åº**
   ```bash
   python main.py
   ```

### é…ç½®æ–‡ä»¶æ ¼å¼

`emby.json` é…ç½®æ–‡ä»¶ç¤ºä¾‹ï¼š
```json
{
    "servers": [
        "https://emby.example1.com:8096/",
        "https://emby.example2.com/",
        "http://192.168.1.100:8096/"
    ],
    "usernames": ["user1", "user2", "user3"],
    "passwords": ["pass1", "pass2", "pass3"]
}
```

## ğŸ–¥ï¸ æœåŠ¡å™¨éƒ¨ç½²

### ç³»ç»Ÿè¦æ±‚

- Linux æœåŠ¡å™¨ (Ubuntu/CentOS/Debian)
- Python 3.8+
- systemd æ”¯æŒ
- ç½‘ç»œè¿æ¥åˆ° Emby æœåŠ¡å™¨

### ä¸€é”®éƒ¨ç½²

1. **ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨**
   ```bash
   scp main.py emby.json deploy.sh emby-keeper-scheduler.sh \
       emby-keeper.service emby-keeper.timer emby-keeper-logrotate \
       user@your-server:/tmp/
   ```

2. **æ‰§è¡Œéƒ¨ç½²è„šæœ¬**
   ```bash
   cd /tmp
   chmod +x deploy.sh emby-keeper-scheduler.sh
   sudo ./deploy.sh
   ```

3. **éªŒè¯éƒ¨ç½²**
   ```bash
   systemctl status emby-keeper.timer
   systemctl list-timers emby-keeper.timer
   ```

### éƒ¨ç½²åçš„æ–‡ä»¶ç»“æ„

```
/opt/emby-alive/
â”œâ”€â”€ main.py                    # ä¸»ç¨‹åº
â”œâ”€â”€ emby.json                  # æœåŠ¡å™¨é…ç½®
â”œâ”€â”€ emby-keeper-scheduler.sh   # è°ƒåº¦è„šæœ¬
â””â”€â”€ .venv/                     # Pythonè™šæ‹Ÿç¯å¢ƒ

/var/log/emby-alive/
â”œâ”€â”€ emby-alive.log            # åº”ç”¨ç¨‹åºæ—¥å¿—
â”œâ”€â”€ scheduler.log             # è°ƒåº¦å™¨æ—¥å¿—
â”œâ”€â”€ service.log               # systemdæœåŠ¡æ—¥å¿—
â””â”€â”€ service-error.log         # systemdé”™è¯¯æ—¥å¿—

/etc/systemd/system/
â”œâ”€â”€ emby-keeper.service       # systemdæœåŠ¡
â””â”€â”€ emby-keeper.timer         # systemdå®šæ—¶å™¨

/etc/logrotate.d/
â””â”€â”€ emby-keeper-logrotate     # æ—¥å¿—è½®è½¬é…ç½®
```

## â° è°ƒåº¦é…ç½®

### é»˜è®¤è°ƒåº¦ç­–ç•¥

- **æ‰§è¡Œæ—¶é—´**: æ¯å¤© 22:00-23:00 ä¹‹é—´éšæœºæ—¶é—´
- **éšæœºå»¶è¿Ÿ**: æœ€å¤š1å°æ—¶çš„éšæœºå»¶è¿Ÿ
- **é˜²é‡å¤**: è‡ªåŠ¨æ£€æµ‹å¹¶é¿å…é‡å¤æ‰§è¡Œ

### è‡ªå®šä¹‰æ—¶é—´çª—å£

å¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡è°ƒæ•´æ‰§è¡Œæ—¶é—´çª—å£ï¼š

```bash
# ä¿®æ”¹ä¸º 20:00-22:00 æ‰§è¡Œ
sudo systemctl edit emby-keeper.service
```

æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š
```ini
[Service]
Environment=START_HOUR=20
Environment=END_HOUR=22
```

## ğŸ“Š æ—¥å¿—ç®¡ç†

### æ—¥å¿—æ–‡ä»¶è¯´æ˜

| æ—¥å¿—æ–‡ä»¶ | å†…å®¹ | ç”¨é€” |
|---------|------|------|
| `emby-alive.log` | åº”ç”¨ç¨‹åºè¾“å‡º | æŸ¥çœ‹æ’­æ”¾ä¼šè¯è¯¦æƒ… |
| `scheduler.log` | è°ƒåº¦å™¨çŠ¶æ€ | ç›‘æ§æ‰§è¡Œæ—¶é—´å’ŒçŠ¶æ€ |
| `service.log` | systemdæœåŠ¡æ—¥å¿— | ç³»ç»Ÿçº§åˆ«çš„æœåŠ¡çŠ¶æ€ |
| `service-error.log` | systemdé”™è¯¯æ—¥å¿— | ç³»ç»Ÿçº§åˆ«çš„é”™è¯¯ä¿¡æ¯ |

### å¸¸ç”¨æ—¥å¿—å‘½ä»¤

```bash
# å®æ—¶æŸ¥çœ‹åº”ç”¨æ—¥å¿—
tail -f /var/log/emby-alive/emby-alive.log

# å®æ—¶æŸ¥çœ‹è°ƒåº¦æ—¥å¿—
tail -f /var/log/emby-alive/scheduler.log

# æŸ¥çœ‹ç³»ç»ŸæœåŠ¡æ—¥å¿—
journalctl -u emby-keeper.service -f

# æŸ¥çœ‹æœ€è¿‘çš„æ‰§è¡Œè®°å½•
journalctl -u emby-keeper.service --since "1 day ago"
```

### æ—¥å¿—è½®è½¬

- **è½®è½¬å‘¨æœŸ**: æ¯æ—¥è½®è½¬
- **ä¿ç•™æ—¶é—´**: 30å¤©
- **å‹ç¼©**: è‡ªåŠ¨å‹ç¼©æ—§æ—¥å¿—
- **æƒé™**: è‡ªåŠ¨è®¾ç½®æ­£ç¡®çš„æ–‡ä»¶æƒé™

## ğŸ”§ æœåŠ¡ç®¡ç†

### åŸºæœ¬å‘½ä»¤

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
systemctl status emby-keeper.timer

# æŸ¥çœ‹ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´
systemctl list-timers emby-keeper.timer

# æ‰‹åŠ¨æ‰§è¡Œä¸€æ¬¡
systemctl start emby-keeper.service

# åœæ­¢å®šæ—¶ä»»åŠ¡
systemctl stop emby-keeper.timer

# é‡å¯å®šæ—¶ä»»åŠ¡
systemctl restart emby-keeper.timer

# ç¦ç”¨æœåŠ¡
systemctl disable emby-keeper.timer
```

### é…ç½®ä¿®æ”¹

```bash
# ä¿®æ”¹EmbyæœåŠ¡å™¨é…ç½®
sudo nano /opt/emby-alive/emby.json

# ä¿®æ”¹æœåŠ¡é…ç½®åé‡è½½
sudo systemctl daemon-reload
sudo systemctl restart emby-keeper.timer
```

## ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

### ç³»ç»Ÿå®‰å…¨

- **ä¸“ç”¨ç”¨æˆ·**: ä½¿ç”¨ `emby-alive` ç”¨æˆ·è¿è¡Œï¼Œé¿å…æƒé™è¿‡é«˜
- **ç›®å½•éš”ç¦»**: é™åˆ¶æ–‡ä»¶ç³»ç»Ÿè®¿é—®æƒé™
- **èµ„æºé™åˆ¶**: é™åˆ¶å†…å­˜ä½¿ç”¨å’ŒCPUå ç”¨
- **ç½‘ç»œå®‰å…¨**: æ”¯æŒè‡ªç­¾åSSLè¯ä¹¦

### é…ç½®æ–‡ä»¶å®‰å…¨

- **æƒé™æ§åˆ¶**: `emby.json` è®¾ç½®ä¸º 600 æƒé™ï¼Œä»…æ‰€æœ‰è€…å¯è¯»å†™
- **æ•æ„Ÿä¿¡æ¯**: å¯†ç ç­‰æ•æ„Ÿä¿¡æ¯ä¸ä¼šå‡ºç°åœ¨æ—¥å¿—ä¸­
- **å¤‡ä»½å»ºè®®**: å®šæœŸå¤‡ä»½é…ç½®æ–‡ä»¶åˆ°å®‰å…¨ä½ç½®

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **SSLè¯ä¹¦é”™è¯¯**
   ```
   [SSL: CERTIFICATE_VERIFY_FAILED]
   ```
   **è§£å†³æ–¹æ¡ˆ**: ç¨‹åºå·²è‡ªåŠ¨ç¦ç”¨SSLéªŒè¯ï¼Œæ”¯æŒè‡ªç­¾åè¯ä¹¦

2. **ç™»å½•å¤±è´¥**
   ```
   ç™»å½•å¤±è´¥: HTTP 401
   ```
   **è§£å†³æ–¹æ¡ˆ**: æ£€æŸ¥ `emby.json` ä¸­çš„ç”¨æˆ·åå’Œå¯†ç æ˜¯å¦æ­£ç¡®

3. **æœåŠ¡æ— æ³•å¯åŠ¨**
   ```
   Failed to start emby-keeper.service
   ```
   **è§£å†³æ–¹æ¡ˆ**: æ£€æŸ¥æ–‡ä»¶æƒé™å’ŒPythonç¯å¢ƒ
   ```bash
   sudo journalctl -u emby-keeper.service -n 50
   ```

4. **æ’­æ”¾å†å²ä¸æ˜¾ç¤º**
   - ç¡®ä¿è§‚çœ‹æ—¶é—´è¶…è¿‡30ç§’
   - æ£€æŸ¥EmbyæœåŠ¡å™¨ç‰ˆæœ¬å…¼å®¹æ€§
   - æŸ¥çœ‹åº”ç”¨æ—¥å¿—ç¡®è®¤APIè°ƒç”¨æˆåŠŸ

### è°ƒè¯•æ¨¡å¼

å¦‚éœ€è°ƒè¯•ï¼Œå¯ä»¥æ‰‹åŠ¨è¿è¡Œç¨‹åºï¼š

```bash
cd /opt/emby-alive
sudo -u emby-alive python3 main.py
```

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0
- âœ… åŸºç¡€æ’­æ”¾ä¼šè¯æ¨¡æ‹ŸåŠŸèƒ½
- âœ… å¤šæœåŠ¡å™¨å¹¶å‘æ”¯æŒ
- âœ… ä¼˜é›…é€€å‡ºå’Œè¿›åº¦ä¿å­˜
- âœ… å®Œæ•´çš„æœåŠ¡å™¨éƒ¨ç½²æ–¹æ¡ˆ
- âœ… éšæœºæ—¶é—´è°ƒåº¦
- âœ… å®Œå–„çš„æ—¥å¿—ç®¡ç†ç³»ç»Ÿ
